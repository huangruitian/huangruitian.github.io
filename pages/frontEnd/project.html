<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>面试心得 | 前端加加首页</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="前端加加的前端记录">
    
    <link rel="preload" href="/my_blog/assets/css/0.styles.7e889f05.css" as="style"><link rel="preload" href="/my_blog/assets/js/app.9ec3da70.js" as="script"><link rel="preload" href="/my_blog/assets/js/2.e3f31b61.js" as="script"><link rel="preload" href="/my_blog/assets/js/27.5d13242f.js" as="script"><link rel="prefetch" href="/my_blog/assets/js/10.660f34a0.js"><link rel="prefetch" href="/my_blog/assets/js/11.04264977.js"><link rel="prefetch" href="/my_blog/assets/js/12.bbd869a5.js"><link rel="prefetch" href="/my_blog/assets/js/13.60d03d23.js"><link rel="prefetch" href="/my_blog/assets/js/14.1e26253a.js"><link rel="prefetch" href="/my_blog/assets/js/15.f0b49b1e.js"><link rel="prefetch" href="/my_blog/assets/js/16.9bbd85dc.js"><link rel="prefetch" href="/my_blog/assets/js/17.93ff155b.js"><link rel="prefetch" href="/my_blog/assets/js/18.01bf3a1b.js"><link rel="prefetch" href="/my_blog/assets/js/19.272ebe19.js"><link rel="prefetch" href="/my_blog/assets/js/20.4de1e0e4.js"><link rel="prefetch" href="/my_blog/assets/js/21.f3f2e17b.js"><link rel="prefetch" href="/my_blog/assets/js/22.715ab356.js"><link rel="prefetch" href="/my_blog/assets/js/23.1b7c1842.js"><link rel="prefetch" href="/my_blog/assets/js/24.8e3a17f0.js"><link rel="prefetch" href="/my_blog/assets/js/25.2421c50e.js"><link rel="prefetch" href="/my_blog/assets/js/26.bf80aaed.js"><link rel="prefetch" href="/my_blog/assets/js/28.097ef5c8.js"><link rel="prefetch" href="/my_blog/assets/js/29.f22210b2.js"><link rel="prefetch" href="/my_blog/assets/js/3.48e58c74.js"><link rel="prefetch" href="/my_blog/assets/js/30.8d832d1a.js"><link rel="prefetch" href="/my_blog/assets/js/31.fe8e5810.js"><link rel="prefetch" href="/my_blog/assets/js/32.91a6282a.js"><link rel="prefetch" href="/my_blog/assets/js/33.353a7174.js"><link rel="prefetch" href="/my_blog/assets/js/4.05257145.js"><link rel="prefetch" href="/my_blog/assets/js/5.a35e0fbe.js"><link rel="prefetch" href="/my_blog/assets/js/6.841ea7d8.js"><link rel="prefetch" href="/my_blog/assets/js/7.db3a0018.js"><link rel="prefetch" href="/my_blog/assets/js/8.7b3de8a6.js"><link rel="prefetch" href="/my_blog/assets/js/9.378a26f9.js">
    <link rel="stylesheet" href="/my_blog/assets/css/0.styles.7e889f05.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my_blog/" class="home-link router-link-active"><!----> <span class="site-name">前端加加首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my_blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/huangruitian" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my_blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/huangruitian" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>html</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my_blog/pages/frontEnd/html.html" class="sidebar-link">语义类标签</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my_blog/pages/frontEnd/html.html#语义类标签" class="sidebar-link">语义类标签</a></li><li class="sidebar-sub-header"><a href="/my_blog/pages/frontEnd/html.html#dom-基本操作" class="sidebar-link">DOM 基本操作</a></li><li class="sidebar-sub-header"><a href="/my_blog/pages/frontEnd/html.html#介绍一下-html5-的一些增强" class="sidebar-link">介绍一下 HTML5 的一些增强</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>es6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>https</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>websocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="面试心得"><a href="#面试心得" class="header-anchor">#</a> 面试心得</h2> <ul><li>每个点必须要有数据支撑；（如果不知道，去背方案，去背套路）</li> <li>难点要挑些重点的来说；避免给自己挖坑；</li></ul> <h3 id="代码规范、文档"><a href="#代码规范、文档" class="header-anchor">#</a> 代码规范、文档；</h3> <p>产生背景：老项目代码，在不断新增功能的同时，互相维护起来非常痛苦；</p> <p>如何分析：主动要求增加 code review，前期稍微多投入点时间，后期固定一个小时；</p> <p>如何实施：code review</p> <ul><li>前期 code review 的时间比较多，因为大家需要确定一些具体统一的规则；</li> <li>后期直接按照流程</li></ul> <ol><li>从 master 拉分支</li> <li>开发原因（hotfix/feature），直至开发完成；（eslint husky第一道卡口）</li> <li>开发完成，合往develop分支联调；</li> <li>调联自测完成，合往test（ci）分支；</li> <li>简单测试，修改BUG完成；</li> <li>合到指定的 reviewer 分支，审查者开始审查代码；有问题地方留下comment供被审查着进行代码改进；</li> <li>被审查者根据comment修改代码，如果有疑问直接问审查者，进行沟通学习；直至 reviewer 通过；</li> <li>合到release分支，测试进行回归测试，准备上线了；预生产测试；</li> <li>回归完成，release，合到master分支；</li> <li>完成之后，各开发分支同步master代码；</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token string">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run test:nowatch &amp;&amp; npm run lint&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext js,less,css src --max-warnings 5 --fix&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>改善了eslint规则，增加 husky + commitlint 规范提交信息和改善代码质量；</li> <li>不带破坏性的改善代码，eslint --fix 自动修复，代码问题需要手动修复；</li></ul> <p>改进成果：</p> <ul><li>commit 信息相对准确有意义，代码质量得到一定的改善；</li> <li>由于公司原因，CI/CD其实没有得到完全的落地；</li> <li>基于此原因，后面子项目全上了TS了，维护得到质的提升；</li></ul> <p>注意点：</p> <ul><li>充分利用了git hook 生命钩子来做一些检测；</li> <li>不能带有破坏性的改动，eslint --fix 只做基础的代码风格修正；如空格分号那种不带破坏性的；</li></ul> <h3 id="构建速度"><a href="#构建速度" class="header-anchor">#</a> 构建速度</h3> <p>背景：打包速度很慢，很不爽；</p> <p>如何分析：</p> <ul><li>speed-measure-webpack-plugin，简称smp分析每个loader的耗时情况；</li> <li>有些loader非常耗时，打包速度很慢；</li> <li>我们要从搜索时间，解析时间，压缩时间三方面进行优化；</li></ul> <ol><li>搜索时间</li></ol> <ul><li>使用 Loader 时可以通过 test 、 include 、 exclude 三个配置项来命中 Loader 要应用规则的文件；</li> <li>优化 resolve.module 配置
<ul><li>优化 resolve.alias 配置，减少层级<code>./../../a.js</code></li> <li>优化 resolve.extensions 扩展名配置，默认<code>js,json</code></li></ul></li></ul> <ol start="2"><li>解析时间</li></ol> <ul><li>开启多进程打包，可以使用thread-loader/happyPack</li> <li>合理的利用缓存，cache-loader加到耗时比较成的loader上；babel-loader 开启cacheDirectory</li> <li>dll 把第三方库提取出来；（http/1.1就尽量提取少组，http/2就提取多几组）</li></ul> <ol start="3"><li>压缩时间</li></ol> <ul><li>terser 启动多进程 使用多进程并行运行来提高构建速度。并发运行的默认数量为 os.cpus().length - 1。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>改进成果：</p> <ul><li>dev 131ms - 53ms，提升60%左右；</li> <li>pro 131ms - 87ms，提升30%左右；</li></ul> <h3 id="项目难点"><a href="#项目难点" class="header-anchor">#</a> 项目难点</h3> <ul><li>封装的组件不灵活，可扩展性不强；（banner 为例，重新改变封装，然后关注了hooks）</li> <li>组件滥用过期生命钩子，业务代码书写不过分关注性能；</li> <li>有时候处理的数据相对复杂，有扎实的算法功底会很好处理；</li> <li>优化数据量大的业务场景；antd 开启了react-window 虚拟长列表；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>场景：弹层从后端持续请求数据返回前端，前端需要修改商品属性；商品可以新增<span class="token operator">/</span>删除、选择<span class="token operator">/</span>不选择；
在渲染后端返回的数据存在两个问题：
<span class="token number">1.</span> 翻页以id为key。其实是不稳定的；因为翻页react需要消耗的性能更大；（搞清楚diff算法）
<span class="token number">2.</span> 在对table页面操作的时候，用户会频繁的操作选和不选：
<span class="token comment">// 假设现在有50条数据；只操作了一条；</span>
<span class="token comment">// 存在的商品就选上，用了O（m * n），而且是频繁的（50 * 50 = 2500）；</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> selectArr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 但是用set O（m + n）100 : 2500 = 1:25 了；</span>
<span class="token keyword">let</span> hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>selectArr<span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> hash<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>发现多处使用 SKU 算法问题，没有进行抽离封装；（抽离封装 回溯算法）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 源数据， 业务场景，用户动态选择属性，生产一个表格</span>
<span class="token comment">// let arr = [{</span>
<span class="token comment">//     id: 'color',</span>
<span class="token comment">//     value: ['1', '2']</span>
<span class="token comment">//   },</span>
<span class="token comment">//   {</span>
<span class="token comment">//     id: 'storage',</span>
<span class="token comment">//     value: ['A', 'B']</span>
<span class="token comment">//   },</span>
<span class="token comment">//   {</span>
<span class="token comment">//     id: 'small',</span>
<span class="token comment">//     value: ['a', 'b']</span>
<span class="token comment">//   }</span>
<span class="token comment">// ]</span>
<span class="token comment">// 排列组合成这样</span>
<span class="token comment">// let tableData = [{</span>
<span class="token comment">//     color: &quot;1&quot;,</span>
<span class="token comment">//     storage: &quot;A&quot;,</span>
<span class="token comment">//     small: &quot;a&quot;</span>
<span class="token comment">//   },</span>
<span class="token comment">//   {</span>
<span class="token comment">//     color: &quot;2&quot;,</span>
<span class="token comment">//     storage: &quot;A&quot;,</span>
<span class="token comment">//     small: &quot;a&quot;</span>
<span class="token comment">//   },</span>
<span class="token comment">// ]</span>

<span class="token comment">// 思路</span>
<span class="token comment">// id:value 抽出来做一个整体。item = 3</span>
<span class="token comment">// 很明显是回溯算法，满足三个（一个坑挑一个），出现过 map 记录</span>

<span class="token comment">// 先把数据处理成这样：</span>
<span class="token comment">// arr = [</span>
<span class="token comment">//     { color:['1','2'] },</span>
<span class="token comment">//     { storage:['A','B'] },</span>
<span class="token comment">//     { small:['a','b'] }</span>
<span class="token comment">// ]</span>

<span class="token keyword">const</span> getPhoneList <span class="token operator">=</span> <span class="token punctuation">(</span>
   arr <span class="token operator">=</span> <span class="token punctuation">[</span>
     <span class="token punctuation">{</span> color<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span> storage<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span> small<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
   <span class="token punctuation">]</span> 
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token function-variable function">backtrack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> tempObj<span class="token punctuation">,</span> set<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>tempObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token comment">// 加入条件   </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span>length <span class="token operator">===</span> arr<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tempObj<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 剪枝</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 选到了第几组属性</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> idx<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> itemObj <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>itemObj<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">let</span> valuesArr <span class="token operator">=</span> itemObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> valuesArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> val <span class="token operator">=</span> valuesArr<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
          tempObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
          <span class="token comment">// 每组选属性一个</span>
          <span class="token function">backtrack</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>tempObj
          <span class="token punctuation">}</span><span class="token punctuation">,</span> set<span class="token punctuation">,</span> idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token comment">// 选完回溯</span>
          <span class="token keyword">delete</span> tempObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
  <span class="token function">backtrack</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getPhoneList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><h3 id="项目性能优化"><a href="#项目性能优化" class="header-anchor">#</a> 项目性能优化</h3> <p>产生背景：老项目代码，在不断新增功能的同时，包的体积变得很大，首屏加载很慢；
主要大方向：</p> <ol><li>减少请求次数</li> <li>减少单次请求所花费的时间</li></ol> <ul><li>打包出来包总共9.8M，首屏业务包3M，本地开发脚本加载执行都要6秒左右，线上更慢，将近十秒；</li> <li>路由懒加载，分离2.1M；依然很大。基础库和业务包打在一起了；</li> <li>分离公共包，dll一些无需打包的第三方库，业务包变1.4M, dll：567KB，vendors：893KB</li> <li>注意：dll适合一些必须要全用的基础库，如果是一些需要Tree shaking 的适合分包，vendors</li></ul> <p>如何分析：Performance面板、LightHouse 与性能 API</p> <ol><li>直接 Performance 的性能面板，小箭头分析大概；</li> <li>npm LightHouse 下载进行分析；</li> <li>Performance.timing  属性分析时间戳；这些时间戳与页面整个加载流程中的关键时间节点有着一一对应的关系；可做性能监控方案；</li></ol> <p>如何实施：</p> <ul><li>webpack-bundle-analyzer 概览模块打包大小，做初次分析；</li></ul> <ol><li>ckplayer引的是未压缩版本201K，min版本138K，直接省了63k</li> <li>首屏无依赖的第三方插件直接放head标签上；像ckplayer应该按需加载；(减少2秒)</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.scss'</span>

<span class="token keyword">function</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>NeighborPage<span class="token punctuation">,</span> setNeighborPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../neighbor'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> component <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setNeighborPage</span><span class="token punctuation">(</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> NeighborPage
    <span class="token operator">?</span> NeighborPage
    <span class="token operator">:</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="3"><li>dll 提取必须的第三方库，与业务代码分离；</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// optimization -&gt; minimizer -&gt; TerserPlugin 进行压缩；</span>
  <span class="token comment">// splitChunks -&gt; chunks: 'async', cacheGroups 分离出来；</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 本Dll文件中各模块的索引，供DllReferencePlugin读取使用</span>
      path<span class="token operator">:</span> <span class="token string">'manifest.json'</span><span class="token punctuation">,</span> 
      <span class="token comment">// 当前Dll的所有内容都会存放在这个参数指定变量名的一个全局变量下，注意与参数output.library保持一致</span>
      name<span class="token operator">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
      <span class="token comment">// 指定一个路径作为上下文环境，需要与DllReferencePlugin的context参数保持一致，建议统一设置为项目根目录       </span>
      context<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// 使用：</span>
  plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      context<span class="token operator">:</span> <span class="token constant">ROOT_PATH</span><span class="token punctuation">,</span> <span class="token comment">// 指定一个路径作为上下文环境，需要与DllPlugin的context参数保持一致，建议统一设置为项目根目录</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./manifest.json&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 指定manifest.json</span>
      <span class="token comment">//name: 'dll',  // 当前Dll的所有内容都会存放在这个参数指定变量名的一个全局变量下，注意与DllPlugin的name参数保持一致</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="4"><li><p>dll 分离不彻底（基本不会变的包都给分离出来了），app主包过大；没有很好的利用缓存；（分离部分：361KB，分离全部 567KB）</p></li> <li><p>懒加载路由</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用：const Law = (props) =&gt; Suspense(props, () =&gt; import('src/js/containers/login/Law'));</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Page <span class="token keyword">from</span> <span class="token string">'components/Page'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> loader</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Component <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span>loader<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Page loading<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Component<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="6"><li>代码写法不利于Tree shaking，随着维护的时间越久，包体积也会越大；</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> loginAction <span class="token keyword">from</span> <span class="token string">'src/js/actions/Login'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> globalAction <span class="token keyword">from</span> <span class="token string">'src/js/actions/global'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="7"><li>生产环境和开发环境都用hash，导致浏览器缓存完全失效；</li></ol> <p>首屏加载速度提升：10秒-5秒；
二次渲染：3秒；</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">8/22/2020, 8:48:58 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/my_blog/assets/js/app.9ec3da70.js" defer></script><script src="/my_blog/assets/js/2.e3f31b61.js" defer></script><script src="/my_blog/assets/js/27.5d13242f.js" defer></script>
  </body>
</html>
